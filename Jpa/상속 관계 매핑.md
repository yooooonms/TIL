# 상속 관계 매핑  

관계형 데이터베이스에는 객체지향 언어에서 다루는 상속이라는 개념이 없다.  

상속대신 슈퍼타입 서브타입 관계라는 모델링 기법이 객체의 상속과 유사하다.  

슈퍼타입 서브타입 논리 모델을 물리 모델은 테이블로 구현할 때는 다음 3가지 방법이 있다.  

- 각각의 테이블로 변환
- 통합 테이블로 변환
- 서브타입 테이블로 변환

## 조인 전략  

엔티티 각각 모두 테이블로 만들고 하위 테이블이 상위 테이블의 기본 키를 받아서 **기본 키 + 외래 키**로 사용하는 전략으로 조회할 때 JOIN을 자주 사용한다.  

주의할 점은 테이블에는 타입의 개념이 없기 때문에 타입을 구분하는 컬럼을 추가해야한다. JPA에서는 DTYPE 이라는 구분 컬럼을 사용한다.  

> 조인 전략은 공통으로 사용하는 컬럼의 상위 클래스 하나랑 하위 테이블이 각각 생성되기 때문에 구분 컬럼을 추가할 필요는 없다.

```java
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
public class Item {

    @Id @GeneratedValue
    @Column(name = "item_id")
    private Long id;

    private String name;
    private int price;
    ...
}

@Entity
public class Book extends Item {
    ...
}

@Entity
public class Album extends Item {
    ...
}

@Entity
public class Movie extends Item {
    ...
}
```

상속 관계를 매핑할 때는 @Inheritance 어노테이션을 사용해야 한다.  

기본값으로 하위 테이블은 상위 테이블의 ID 컬럼명을 그대로 사용한다.  

만약 하위 테이블의 기본 키 컬럼명을 변경하고 싶으면 하위 엔티티에 @PrimaryKeyJoinColumn을 사용하면 된다.  

조인 방식의 장점은 다음과 같다.  

- 테이블이 정규화된다.
- 외래 키 참조 무결성 제약조건을 활용할 수 있다.
- 저장공간을 효율적으로 사용한다.

하지만 조회할 때 조인이 많이 사용되므로 성능이 저하될 수 있고 조회 쿼리가 복잡하다.  

그리고 데이터를 등록할 때 INSERT SQL을 두 번 실행한다. **ITEM 테이블 한 번 + ITEM의 하위 테이블 한 번**  

## 단일 테이블 전략  

테이블을 하나만 사용하는 전략으로 구분 컬럼을 통해 어떤 데이터가 저장되었는지 구분한다.  

조회할 때 조인을 사용하지 않기 때문에 가장 빠르다.  

테이블을 하나에 모든 것을 통합하기 때문에 구분 컬럼을 필수로 사용해야 한다.  

- @DiscriminatorColumn(name = "DTYPE"): 상위 클래스에 구분 컬럼을 지정한다. 해당 컬럼을 통해 하위 테이블을 구분할 수 있다. 기본값은 DTYPE이다.
- @DiscriminatorValue("BOOK"): 엔티티를 저장할 때 구분 컬럼에 입력할 값을 지정한다.

주의할 점은 하위 엔티티가 매핑한 컬럼은 모두 null을 허용해야 한다.  

예를 들어 BOOK 엔티티를 저장하면 ITEM 테이블의 Author, ISBN 컬럼만 사용하고 다른 엔티티와 매핑된 컬럼은 사용하지 않기 때문에 모두 null로 입력된다.  

조인이 필요 없기 때문에 일반적으로 조회 성능이 빠르고 쿼리가 단순하지만 하위 엔티티가 매핑한 컬럼은 모두 null을 허용해야 하고 테이블 하나에 모든 것을 저장하기 때문에 테이블이 커질 수 있다.  

구분 컬럼을 꼭 사용해야 하고 @DiscriminatorValue를 지정하지 않으면 기본으로 엔티티 이름을 사용한다.  

## 구현 클래스마다 테이블을 생성하는 전략  

하위 엔티티마다 테이블을 만들고 각각에 필요한 컬럼이 모두 있다. 추천하지 않는 전략이다.  

서브 타입을 구분해서 처리할 때 효과적이고 not null 제약조건을 사용할 수 있다.  

여러 하위 테이블을 함께 조회할 때 성능이 느리다. 하위 테이블을 통합해서 쿼리하기가 힘들다.  

구분 컬럼을 사용하지 않는다.  

<br>

싱글 테이블 전략이나 조인 전략을 사용하는 것이 좋다.  

또는 개발 초기에는 싱글 테이블 전략을 사용하다가 애플리케이션이 커지면서 정규화가 필요할 때 조인 전략으로 변경하는 것도 방법이다.  

---

#### 📌 Reference  

- 자바 ORM 표준 JPA 프로그래밍 | 김영한 저